# Web如何运作

**转叙MDN**

## 当使用浏览器访问网页时发生了什么？



### 客户端和服务器

连接到互联网的计算机被称作客户端和服务端。下面是简述他们如何交互的：

```
----------                      ----------
|        |   ——————>  request   |        |   
| ClIENT |                      | SERVER |
|        |   response <—————    |        |                
----------                      ----------
```
- 客户端是典型的Web用户入网设备（比如，连接了wifi的电脑，或接入移动网络的手机）和设备上可联网的软件（浏览器app等）。
  
- 服务器是存储网页，站点和应用的计算机。当一个客户端设备想要获取一个网页时，一份网页的拷贝将从服务器上下载到客户端机器上来在用户浏览器上显示。

### 其他部分

上文所述的客户端和服务器并不能完成全部工作。还需要理解的其他部分：

假设你生活在一个封闭的村子叫做“新村”，村子盛产苹果。
- 互联网
  - 好比地球上纵横交错的道路。
  
- 网络连接：允许你在互联网上发送和接受数据。道路涌到了村子路口。
  - 从此，村子里的苹果可以运出去卖了。

- TCP/IP：传输控制协议和因特网互联协议是定义数据如何传输的通信协议。
  - 为了将村里的苹果能规范有效的运卖出去而不出问题，村子作出如下规定：“用规格刚好20cm*20cm*20cm的泡沫箱来装，之后外卖又用相应规格的纸箱包裹上，最后打上透明胶”。
  - 并且要求对方收到时，一定要外包装完好，不然就会补发。
  - 而且还给对方发了一张发货单，明确说明了，苹果有多少，是用什么方法包装的，只有货与发货单对上了，对方才会确认收货。

- DNS：当你在浏览器内输入一个网址时，浏览器获取网页之前将会查看域名系统。浏览器需要找到存放你想要的网页的服务器，才能发送HTTP请求到正确的地方。
  - 突然一天，郭德纲想吃苹果，就跟于谦说：“我听说新村（域名）的苹果好，要他们的套餐一选项”，
  - 于谦一听，得，也不知道“新村”在哪，只有打开地图查（DNS）吧，一查，好嘛，四川省成都市（IP地址），
  - 于是于谦去了成都，找到了村子，告诉村长，要套餐一，要用顺丰快递，并且留下了北京德云社的地址。

- HTTP：超文本传输协议是一个定义客户端和服务器间交流的语言的协议（protocol）。
  - 过了几天，德云社的人一看，有快递来了，来了这么一句，“只收顺丰，拒收其他快递”。
  - 司机忙说：“是顺丰，是顺丰”，这才对上暗号，德云社的人收下了货、

- 组成文件：一个网页由许多文件组成。这些文件有两种类型：
    - 送来的货可不止一车，而且也不止一种苹果，这车是红富士，那车黄富士的
  - 代码：网页大体由HTML、CSS、JavaScript组成。
    - 有点像，村长事先安排的说明书，让司机到了地方，如何卸车，货到什么位置，
    - 而德云社的看说明书，知道什么样的苹果放到什么位置上，什么样苹果如何食用最佳等等。
  - 资源：这是其他组成网页的东西的集合，比如图像、音乐、视频、文档等。
    - 不同种类的苹果。



### 当你在浏览器里输入一个网址时，到底发生了什么？

1. 浏览器在域名系统（DNS）服务器上找出存放网页的服务器的实际地址。
   
2. 浏览器发送HTTP请求信息到服务器来清拷贝一份网页到客户端。这条消息，包括其他所有在客户端和服务器之间传递的数据都是通过互联网使用TCP/IP协议传输的。
   
3. 服务器同意客户端的请求后，会返回一个“200 OK”的信息，意味着“你可以查看这个网页，给你~”，然后开始将网页的文件以数据包的形式传输到浏览器。
   
4. 浏览器将数据包聚集成完整的网页然后将网页呈现给你。



### 解析组成文件的顺序

1. 当浏览器向服务器发送请求获取HTML文件时，HTML文件通常包含`<link>`和`<script>`元素，这些元素分别指向外部的CSS样式表文件和JavaScript脚本文件。
   
2. 这些文件被浏览器解析的顺序为：
   1. 浏览器首先解析HTML文件，并从中识别出所有的`<link>`和`<script>`元素，获取衙门指向的外部文件链接。
   2. 继续解析HTML文件的同时，浏览器根据外部文件的链接向服务器发送请求，获取并解析CSS文件和JavaScript脚本文件。
   3. 接着浏览器会给解析后的HTML文件生成一个DOM树（在内存中），会给解析后的CSS文件生成一个CSSOM树（在内存中），并且会编译和执行解析后的JavaScript脚本文件。
   4. 伴随着构建DOM树、应用CSSOM树的样式、以及执行JavaScript脚本文件，浏览器会在屏幕上绘制出网页的界面；用户看到网页界面也就可以跟网页进行交互了。

#### CSSOM（CSS Object Modal）

1. CSS对象模型（CSSOM）是树形形式的所有CSS选择器和每个选择的相关属性的映射，具有树的根节点，同级，后代，子级和其他关系。
   
2. CSSOM与DOM（文档对象模型）非常相似。两者都是**关键渲染路径**的一部分，也是正确渲染一个网站必须采取的一系列步骤。
   
3. CSSOM与DOM一起构建渲染树，浏览器依次使用渲染树来布局和绘制网页。


### DNS解析

1. 真正的网址看上去并不像你输入到地址框中的那样美好且容易记忆。他们是一串数字，像`63.245.217.105`。

2. 这叫做IP地址，他代表了一个互联网上独特的位置。然后并不容易记忆，那就是域名系统（DNS）被发明的原因。
   
3. 他们是将你输入浏览器的地址（像"www.baidu.com"）与实际IP地址相匹配的特殊的服务器。

4. 网页可以通过IP地址直接访问。



### 数据包详解

1. 前面我们用“包”来描述了数据从服务器到客户端传输的格式。
   
2. 基本上，当数据在Web上传输时，是以成千上万的小数据块的形式传输的。
   
3. 大量不同的用户都可以同时下载同一个网页。
   
4. 如果网页以单个大的数据块形式传输，一次就只有一个用户下载，无疑会让Web非常没有效率并且失去很多乐趣。



## 拓展阅读

### 互联网是如何工作的

https://developer.mozilla.org/zh-CN/docs/Learn/Common_questions/How_does_the_Internet_work

1. 调制解调器：可以把网络信息变成电话设施可以处理的信息，反之亦然。

2. 互联网服务提供商（ISP）；
   
3. IP地址：唯一的地址标记；
   
4. 域名：IP地址别名；

5. 互联网是基础设施，网络是建立在这种基础设施之上的服务。

#### 了解网页，网站，网络服务器和搜索引擎间的区别

- 网页（webpage）
  一份能够显示在网络浏览器上的文档。网页也常被称作“web pages”（网页）或者就叫“pages”（页面）
  
- 网站（website）
  一个由许多组合在一起，并常常以各种方式相互连接的网页组成的集合。网站被称作“web site”（网站）或简称“site”（站点）

- 网络服务器（web server）
  一个互联网上托管网站的计算机。

- 搜索引擎（search engine）
  帮助你寻找其他网站的网站，比如百度，谷歌。
  
### HTTP —— 一种应用级协议

### HTTP: 让我们开始吧！

### HTTP：响应代码